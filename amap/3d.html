<html>

<head>
    <link rel="stylesheet" href="map.css">
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.4.5&key=9ab008b291ee69781485ab1adce836d8&plugin=Map3D"></script>
</head>

<body>
    <div id="map_container"></div>
    <div id="map_control">
        <div>
            <button id="patch_add">+patch</button>
            <button id="patch_minus">-patch</button>
            <button id="rotation_add">+rotation</button>
            <button id="rotation_minus">-rotation</button>
            <button id="start_rotating">start rotating</button>
            <button id="stop_rotating">stop rotating</button>
            <button id="start_zoom">start zoom</button>
            <button id="stop_zoom">stop zoom</button>
            <button id="prism">prirm</button>
        </div>
    </div>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.js"></script>
    <script>
        var map = new AMap.Map('map_container', {
            resizeEnable: true,
            zoom: 20,
            center: [113, 23],
            pitch: 50,
            viewMode: '3D',
            mapStyle: "amap://styles/aaadd24c5d8483a20ded5cea742dcecc"
        });

        $('#patch_add').bind('click', function (e) {
            map.setPitch((map.getPitch() + 1) >= 83 ? 83 : (map.getPitch() + 1));
        });

        $('#patch_minus').bind('click', function (e) {
            map.setPitch((map.getPitch() - 1) <= 0 ? 0 : (map.getPitch() - 1));
        });

        $('#rotation_add').bind('click', function (e) {
            map.setRotation((map.getRotation() + 1) >= 360 ? 360 : (map.getRotation() + 1));
        });

        $('#rotation_minus').bind('click', function (e) {
            map.setRotation((map.getRotation() - 1) <= 0 ? 0 : (map.getRotation() - 1));
        });

        var rotating_flag = -1;

        $('#start_rotating').bind('click', function (e) {
            rotating_flag = setInterval(function () {
                map.setRotation((map.getRotation() + 0.1) >= 360 ? 360 : (map.getRotation() + 0.1));
            }, 10);
        });

        $('#stop_rotating').bind('click', function (e) {
            clearInterval(rotating_flag);
        });

        var zoom_flag = -1;

        $('#start_zoom').bind('click', function (e) {
            zoom_flag = setInterval(function () {
                map.setZoom((map.getZoom() + 0.1) >= 20 ? 20 : (map.getZoom() + 0.1));
            }, 100);
        });

        $('#stop_zoom').bind('click', function (e) {
            clearInterval(zoom_flag);
        });

        $('#prism').bind('click', function (e) {
            var object3Dlayer = new AMap.Object3DLayer();
            map.add(object3Dlayer);
            var bounds = [
                [ //大圈
                    new AMap.LngLat(116, 39),
                    new AMap.LngLat(117, 39),
                    new AMap.LngLat(117, 40),
                    new AMap.LngLat(116, 40)
                ],
                [ //洞1
                    new AMap.LngLat(116.5, 39.25),
                    new AMap.LngLat(116.75, 39.5),
                    new AMap.LngLat(116.5, 39.75),
                    new AMap.LngLat(116.25, 39.5)
                ],
                [ //洞2
                    new AMap.LngLat(116.75, 39.75),
                    new AMap.LngLat(116.9, 39.5),
                    new AMap.LngLat(116.9, 39.75)
                ],
                [ //岛1
                    new AMap.LngLat(117.5, 39.25),
                    new AMap.LngLat(117.75, 39.5),
                    new AMap.LngLat(117.5, 39.75),
                    new AMap.LngLat(117.25, 39.5)
                ],
                [ //岛2
                    new AMap.LngLat(118.5, 39.25),
                    new AMap.LngLat(118.75, 39.5),
                    new AMap.LngLat(118.5, 39.75),
                    new AMap.LngLat(118.25, 39.5)
                ]
            ]
            // var lnglatToG20 =  function(lnglats) {
            //     for (var i = 0; i < lnglats.length; i += 1) {
            //         var g20 = map.lngLatToGeodeticCoord(lnglats[i]);
            //         lnglats[i] = g20
            //     }
            //     return lnglats;
            // }
            // for (var i = 0; i < bounds.length; i += 1) {
            //     bounds[i] = lnglatToG20(bounds[i]);
            // }
            var height = 300000;
            var color = [0, 0, 1, 0.9];
            var prism = new AMap.Object3D.Prism({
                path: bounds,
                height: height,
                color: color
            });
            prism.transparent = true;
            object3Dlayer.add(prism);
        });
    </script>
</body>

</html>